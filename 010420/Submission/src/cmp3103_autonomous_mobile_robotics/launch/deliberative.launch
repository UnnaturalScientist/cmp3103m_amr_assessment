<launch>

    <!--
    __________________________________________________________________________________________________________
    Deliberative.launch: Brief Description
    __________________________________________________________________________________________________________
    As the Turtlebot is the perfect tool to become more acquainted with ROS and the navigation stack, it
    proved beneficial to simply use the general configuration found in the turtlbot navigation package.
    The two nodes from the nav core, being DWA planner and Navfm have also been untilised. In addition, there
    is a remapping of the command velocity used so that it mat be compatible with the coordinator/multiplexer.
    -->

    <!-- determine how these work precisely. I am not calling them... so -->
    <node name="planner" pkg="cmp3103_autonomous_mobile_robotics" type="deliberative.py" output="screen"/>

    <include file="$(find cmp3103_autonomous_mobile_robotics)/launch/mapping_and_localisation/map_amcl.launch"/>

    <!-- this will launch the UOL Turtlebot Maze (1, 2 or 3) for testing -->
    <include file="$(find uol_turtlebot_simulator)/launch/maze1.launch"/>
    <!--
    <include file="$(find uol_turtlebot_simulator)/launch/maze2.launch"/>
    <include file="$(find uol_turtlebot_simulator)/launch/maze3.launch"/>
     -->

    <!-- determine how these work precisely. I am not calling them... so -->
    <include file="$(find turtlebot_navigation)/launch/includes/velocity_smoother.launch.xml"/>
    <include file="$(find turtlebot_navigation)/launch/includes/safety_controller.launch.xml"/>

    <!-- are these just a safety precaution, should the frame_id differ? -->
    <arg name="odom_frame_id" default="odom"/>
    <arg name="base_frame_id" default="base_footprint"/>
    <arg name="global_frame_id" default="map"/>
    <arg name="odom_topic" default="odom"/>
    <arg name="laser_topic" default="scan"/>
    <arg name="custom_param_file" default="$(find turtlebot_navigation)/param/dummy.yaml"/>

    <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen">

        <rosparam file="$(find cmp3103_autonomous_mobile_robotics)/config/costmap_common_params.yaml" command="load" ns="global_costmap"/>
        <rosparam file="$(find cmp3103_autonomous_mobile_robotics)/config/global_costmap_params.yaml" command="load"/>

        <rosparam file="$(find cmp3103_autonomous_mobile_robotics)/config/costmap_common_params.yaml" command="load" ns="local_costmap"/>
        <rosparam file="$(find cmp3103_autonomous_mobile_robotics)/config/local_costmap_params.yaml" command="load"/>

        <!-- are these two (move base and global) needed if dwa and navfn are present? -->
        <rosparam file="$(find cmp3103_autonomous_mobile_robotics)/config/move_base_params.yaml" command="load"/>
        <rosparam file="$(find cmp3103_autonomous_mobile_robotics)/config/global_planner_params.yaml" command="load"/>

        <rosparam file="$(find cmp3103_autonomous_mobile_robotics)/config/dwa_local_planner_params.yaml" command="load"/>
        <rosparam file="$(find cmp3103_autonomous_mobile_robotics)/config/navfn_global_planner_params.yaml" command="load"/>
        <!-- external params file that could be loaded into the move_base namespace -->
        <rosparam file="$(arg custom_param_file)" command="load"/>

        <!-- reset frame_id parameters using user input data -->
        <param name="global_costmap/global_frame" value="$(arg global_frame_id)"/>
        <param name="global_costmap/robot_base_frame" value="$(arg base_frame_id)"/>
        <param name="local_costmap/global_frame" value="$(arg odom_frame_id)"/>
        <param name="local_costmap/robot_base_frame" value="$(arg base_frame_id)"/>
        <param name="DWAPlannerROS/global_frame_id" value="$(arg odom_frame_id)"/>

        <remap from="cmd_vel" to="navigation_velocity_smoother/raw_cmd_vel"/>
        <remap from="odom" to="$(arg odom_topic)"/>
        <remap from="scan" to="$(arg laser_topic)"/>

    </node>

</launch>

<!--
__________________________________________________________________________________________________________
References
__________________________________________________________________________________________________________
Turtlebot Navigation Package

DWA Planner

Navfn

General Navigation Stack

-->